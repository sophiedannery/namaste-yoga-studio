{% extends 'base.html.twig' %}

{% block title %}Gérer les comptes élève
{% endblock %}

{% block body %}

	{% set now = date() %}


	<section class="py-5">
		<div class="container">


			<h1 class="hero-heading mb-5 mt-3 mt-md-0">Liste des cours</h1>

			<div class="table-responsive">
				<table class="table table-striped table-hover">
					<thead>
						<tr>
							<th>Date</th>
							<th>Horaires</th>
							<th>Professeur</th>
							<th>Cours</th>
							<th>Salle</th>
							<th>Statut</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody>
						{% for session in sessions %}

							{% set state = session.status == 'CANCELLED' ? 'CANCELLED' : (session.endAt < now ? 'FINISHED' : 'UPCOMING') %}

							<tr>
								<td>{{ session.startAt|date('d/m/Y') }}</td>
								<td>{{ session.startAt|date('H:i') }}
									–
									{{ session.endAt|date('H:i') }}</td>
								<td>{{ session.teacher.lastName }}
									{{ session.teacher.firstName }}</td>

								<td>{{ session.classType.title }}</td>
								<td>{{ session.room ? session.room.nameRoom : '—'  }}</td>
								<td>
									{% if state == 'CANCELLED' %}
										<span class="badge text-bg-danger">Annulé</span>
									{% elseif state == 'FINISHED' %}
										<span class="badge text-bg-secondary">Terminé</span>
									{% else %}
										<span class="badge text-bg-success">À venir</span>
									{% endif %}
								</td>
								<td>
									{% if state not in ['CANCELLED', 'FINISHED'] %}
										<button type="button" class="btn btn-secondary px-4 me-md-2" data-bs-toggle="modal" data-bs-target="#confirmCancelSessionAdminModal" data-action="{{ path('app_session_annuler_admin', {'id': session.id}) }}" data-token="{{ csrf_token('cancel_session_admin' ~ session.id) }}" data-title="Confirmer l'annulation de ce cours'" data-body="Voulez-vous vraiment supprimer le cours {{ session.classType.title }} du {{ session.startAt|date('d/m/Y') }}, organisé par {{ session.teacher.lastName }} {{ session.teacher.firstName }} ?">
											Supprimer
										</button>
									{% endif %}
								</td>
							</tr>
						{% else %}
							<tr>
								<td colspan="7">Pas de cours.</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			<div class="text-center m-5">
				<a class="btn btn-secondary px-4 me-md-2" href="{{ path('app_admin')}}">Retour</a>
			</div>
		</div>
	</section>

	{# Modal suppression d'une session par admin #}
	<div class="modal fade" id="confirmCancelSessionAdminModal" aria-hidden="true">
		<div class="modal-dialog">
			<form method="post" class="modal-content" id="confirmCancelSessionAdminForm">
				<div class="modal-header">
					<h1 class="modal-title fs-5" id="confirmCancelSessionAdminLabel">Confirmer la suppression</h1>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
				</div>

				<div class="modal-body" id="confirmCancelSessionAdminBody">
					Voulez-vous vraiment supprimer ce cours ?
				</div>

				<div class="modal-footer">
					<input type="hidden" name="_token" id="cancelSessionAdminToken">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Non, revenir</button>
					<button type="submit" class="btn btn-danger">Oui, supprimer</button>
				</div>
			</form>
		</div>
	</div>
	<script src="/js/modal.js" defer></script>

{% endblock %}
